let clothTextImageObject = {
  "polo-t-shirt": {
    front: [
      {
        canvasId: "polo-t-shirt-1",
        canvasWidth: 210,
        canvasHeight: 100,
        topMargin: 220,
        leftMargin: 95,
      },
      {
        canvasId: "polo-t-shirt-2",
        canvasWidth: 210,
        canvasHeight: 100,
        topMargin: 340,
        leftMargin: 95,
      },
      {
        canvasId: "polo-t-shirt-3",
        canvasWidth: 65,
        canvasHeight: 75,
        topMargin: 92,
        leftMargin: 95,
      },
      {
        canvasId: "polo-t-shirt-4",
        canvasWidth: 65,
        canvasHeight: 75,
        topMargin: 92,
        leftMargin: 235,
      },
    ],
    back: [
      {
        canvasId: "polo-t-shirt-5",
        canvasWidth: 230,
        canvasHeight: 130,
        topMargin: 175,
        leftMargin: 80,
      },
      {
        canvasId: "polo-t-shirt-6",
        canvasWidth: 230,
        canvasHeight: 80,
        topMargin: 330,
        leftMargin: 80,
      },
      {
        canvasId: "polo-t-shirt-7",
        canvasWidth: 185,
        canvasHeight: 50,
        topMargin: 75,
        leftMargin: 105,
      },
      {
        canvasId: "polo-t-shirt-8",
        canvasWidth: 85,
        canvasHeight: 20,
        topMargin: 48,
        leftMargin: 155,
      },
    ],
    left: [
      {
        canvasId: "polo-t-shirt-9",
        canvasWidth: 77,
        canvasHeight: 40,
        topMargin: 120,
        leftMargin: 173,
      },
      {
        canvasId: "polo-t-shirt-10",
        canvasWidth: 77,
        canvasHeight: 40,
        topMargin: 175,
        leftMargin: 173,
      },
    ],
    right: [
      {
        canvasId: "polo-t-shirt-11",
        canvasWidth: 77,
        canvasHeight: 40,
        topMargin: 120,
        leftMargin: 138,
      },
      {
        canvasId: "polo-t-shirt-12",
        canvasWidth: 77,
        canvasHeight: 40,
        topMargin: 175,
        leftMargin: 138,
      },
    ],
  },
  "cotton-t-shirt": {
    front: [
      {
        canvasId: "cotton-t-shirt-1",
        canvasWidth: 210,
        canvasHeight: 100,
        topMargin: 230,
        leftMargin: 95,
      },
      {
        canvasId: "cotton-t-shirt-2",
        canvasWidth: 210,
        canvasHeight: 100,
        topMargin: 350,
        leftMargin: 95,
      },
      {
        canvasId: "cotton-t-shirt-3",
        canvasWidth: 65,
        canvasHeight: 75,
        topMargin: 120,
        leftMargin: 90,
      },
      {
        canvasId: "cotton-t-shirt-4",
        canvasWidth: 65,
        canvasHeight: 75,
        topMargin: 120,
        leftMargin: 245,
      },
    ],
    back: [
      {
        canvasId: "cotton-t-shirt-5",
        canvasWidth: 200,
        canvasHeight: 130,
        topMargin: 250,
        leftMargin: 100,
      },
      {
        canvasId: "cotton-t-shirt-6",
        canvasWidth: 200,
        canvasHeight: 80,
        topMargin: 400,
        leftMargin: 100,
      },
      {
        canvasId: "cotton-t-shirt-7",
        canvasWidth: 185,
        canvasHeight: 50,
        topMargin: 130,
        leftMargin: 110,
      },
      {
        canvasId: "cotton-t-shirt-8",
        canvasWidth: 85,
        canvasHeight: 20,
        topMargin: 88,
        leftMargin: 155,
      },
    ],
    left: [
      {
        canvasId: "cotton-t-shirt-9",
        canvasWidth: 77,
        canvasHeight: 30,
        topMargin: 145,
        leftMargin: 176,
      },
      {
        canvasId: "cotton-t-shirt-10",
        canvasWidth: 77,
        canvasHeight: 30,
        topMargin: 190,
        leftMargin: 176,
      },
    ],
    right: [
      {
        canvasId: "cotton-t-shirt-11",
        canvasWidth: 77,
        canvasHeight: 30,
        topMargin: 145,
        leftMargin: 146,
      },
      {
        canvasId: "cotton-t-shirt-12",
        canvasWidth: 77,
        canvasHeight: 30,
        topMargin: 190,
        leftMargin: 146,
      },
    ],
  },
  bottom: {
    front: [
      {
        canvasId: "bottom-1",
        canvasWidth: 50,
        canvasHeight: 100,
        topMargin: 70,
        leftMargin: 120,
      },
      {
        canvasId: "bottom-2",
        canvasWidth: 50,
        canvasHeight: 100,
        topMargin: 70,
        leftMargin: 220,
      },
    ],
    back: [
      {
        canvasId: "bottom-3",
        canvasWidth: 50,
        canvasHeight: 100,
        topMargin: 70,
        leftMargin: 120,
      },
      {
        canvasId: "bottom-4",
        canvasWidth: 50,
        canvasHeight: 100,
        topMargin: 70,
        leftMargin: 220,
      },
    ],
  },
  short: {
    front: [
      {
        canvasId: "short-1",
        canvasId: "cotton-t-shirt-17",
        canvasWidth: 100,
        canvasHeight: 100,
        topMargin: 130,
        leftMargin: 60,
      },
      {
        canvasId: "short-2",
        canvasId: "cotton-t-shirt-18",
        canvasWidth: 100,
        canvasHeight: 100,
        topMargin: 130,
        leftMargin: 235,
      },
      {
        canvasId: "short-3",
        canvasId: "cotton-t-shirt-19",
        canvasWidth: 100,
        canvasHeight: 100,
        topMargin: 290,
        leftMargin: 60,
      },
      {
        canvasId: "short-4",
        canvasWidth: 100,
        canvasHeight: 100,
        topMargin: 290,
        leftMargin: 235,
      },
    ],
    back: [
      {
        canvasId: "short-5",
        canvasWidth: 100,
        canvasHeight: 100,
        topMargin: 130,
        leftMargin: 60,
      },
      {
        canvasId: "short-6",
        canvasWidth: 100,
        canvasHeight: 100,
        topMargin: 130,
        leftMargin: 235,
      },
      {
        canvasId: "short-7",
        canvasWidth: 100,
        canvasHeight: 100,
        topMargin: 290,
        leftMargin: 60,
      },
      {
        canvasId: "short-8",
        canvasWidth: 100,
        canvasHeight: 100,
        topMargin: 290,
        leftMargin: 235,
      },
    ],
    right: [
      {
        canvasId: "short-9",
        canvasWidth: 0,
        canvasHeight: 0,
        topMargin: 0,
        leftMargin: 0,
      },
    ],
    left: [
      {
        canvasId: "short-10",
        canvasWidth: 0,
        canvasHeight: 0,
        topMargin: 0,
        leftMargin: 0,
      },
    ],
  },
  singlet: {
    front: [
      {
        canvasId: "singlet-1",
        canvasWidth: 150,
        canvasHeight: 100,
        topMargin: 230,
        leftMargin: 125,
      },
      {
        canvasId: "singlet-2",
        canvasWidth: 150,
        canvasHeight: 100,
        topMargin: 350,
        leftMargin: 125,
      },
      {
        canvasId: "singlet-3",
        canvasWidth: 50,
        canvasHeight: 50,
        topMargin: 150,
        leftMargin: 125,
      },
      {
        canvasId: "singlet-4",
        canvasWidth: 50,
        canvasHeight: 50,
        topMargin: 150,
        leftMargin: 225,
      },
    ],
    back: [
      {
        canvasId: "singlet-5",
        canvasWidth: 180,
        canvasHeight: 130,
        topMargin: 240,
        leftMargin: 110,
      },
      {
        canvasId: "singlet-6",
        canvasWidth: 180,
        canvasHeight: 80,
        topMargin: 390,
        leftMargin: 110,
      },
      {
        canvasId: "singlet-7",
        canvasWidth: 150,
        canvasHeight: 50,
        topMargin: 150,
        leftMargin: 123,
      },
      {
        canvasId: "singlet-8",
        canvasWidth: 85,
        canvasHeight: 20,
        topMargin: 60,
        leftMargin: 155,
      },
    ],
    left: [],
    right: [],
  },
  jacket: {
    front: [
      {
        canvasId: "jacket-1",
        canvasWidth: 210,
        canvasHeight: 80,
        topMargin: 360,
        leftMargin: 100,
      },
      {
        canvasId: "jacket-2",
        canvasWidth: 210,
        canvasHeight: 80,
        topMargin: 290,
        leftMargin: 100,
      },
      {
        canvasId: "jacket-3",
        canvasWidth: 65,
        canvasHeight: 75,
        topMargin: 170,
        leftMargin: 100,
      },
      {
        canvasId: "jacket-4",
        canvasWidth: 65,
        canvasHeight: 75,
        topMargin: 170,
        leftMargin: 245,
      },
    ],
    back: [
      {
        canvasId: "jacket-5",
        canvasWidth: 200,
        canvasHeight: 80,
        topMargin: 250,
        leftMargin: 105,
      },
      {
        canvasId: "jacket-6",
        canvasWidth: 200,
        canvasHeight: 60,
        topMargin: 350,
        leftMargin: 105,
      },
      {
        canvasId: "jacket-7",
        canvasWidth: 200,
        canvasHeight: 40,
        topMargin: 170,
        leftMargin: 105,
      },
    ],
    left: [
      {
        canvasId: "jacket-8",
        canvasWidth: 30,
        canvasHeight: 70,
        topMargin: 180,
        leftMargin: 220,
      },
    ],
    right: [
      {
        canvasId: "jacket-9",
        canvasWidth: 30,
        canvasHeight: 70,
        topMargin: 180,
        leftMargin: 130,
      },
    ],
  },
};

//
// product Idnetifier
function productIdentifier() {
  const currentProduct = dataObject.clothType;
  if (currentProduct == "polo-t-shirt") {
    dataObject.views.imageTextContanerData =
      clothTextImageObject["polo-t-shirt"];
  } else if (currentProduct == "cotton-t-shirt") {
    dataObject.views.imageTextContanerData =
      clothTextImageObject["cotton-t-shirt"];
  } else if (currentProduct == "bottom") {
    dataObject.views.imageTextContanerData = clothTextImageObject["bottom"];
  } else if (currentProduct == "jacket") {
    dataObject.views.imageTextContanerData = clothTextImageObject["jacket"];
  } else if (currentProduct == "short") {
    dataObject.views.imageTextContanerData = clothTextImageObject["short"];
  } else if (currentProduct == "singlet") {
    dataObject.views.imageTextContanerData = clothTextImageObject["singlet"];
  }

  imageTextSectionRenderer();
}

// image Text render
function imageTextSectionRenderer() {
  allCanvasElements = []; // clear all canavas array

  // front
  const frontArray = dataObject.views.imageTextContanerData.front;
  document.getElementById("canvasOverlyFront").innerHTML = "";
  frontArray.forEach((element) => {
    canvasBuilder(
      element.canvasId,
      "canvasOverlyFront",
      element.canvasWidth,
      element.canvasHeight,
      element.topMargin,
      element.leftMargin
    );
  });

  // back
  const backArray = dataObject.views.imageTextContanerData.back;
  document.getElementById("canvasOverlyBack").innerHTML = "";
  backArray.forEach((element) => {
    canvasBuilder(
      element.canvasId,
      "canvasOverlyBack",
      element.canvasWidth,
      element.canvasHeight,
      element.topMargin,
      element.leftMargin
    );
  });

  // left
  const leftArray = dataObject.views.imageTextContanerData.left;
  document.getElementById("canvasOverlyLeft").innerHTML = "";
  leftArray.forEach((element) => {
    canvasBuilder(
      element.canvasId,
      "canvasOverlyLeft",
      element.canvasWidth,
      element.canvasHeight,
      element.topMargin,
      element.leftMargin
    );
  });

  // right
  const rightArray = dataObject.views.imageTextContanerData.right;
  document.getElementById("canvasOverlyRight").innerHTML = "";
  rightArray.forEach((element) => {
    canvasBuilder(
      element.canvasId,
      "canvasOverlyRight",
      element.canvasWidth,
      element.canvasHeight,
      element.topMargin,
      element.leftMargin
    );
  });
  //
  //
  //
  //
  // loadText
  loadTextDataFromSaved();
}

function loadTextDataFromSaved() {
  let textData = dataObject.views.generatedTextData;
  for (let u = 0; u < allCanvasElements.length; u++) {
    textData.forEach((element) => {
      if (element.id === allCanvasElements[u].lowerCanvasEl.id) {
        allCanvasElements[u].loadFromJSON(JSON.parse(element.data), () => {
          allCanvasElements[u].renderAll();
        });
      }
    });
  }
}

let selectedInputCanvas = null;
let selectedItem = null;
let allCanvasElements = [];
let allCanvasTexts = [];

function canvasBuilder(
  id,
  canvasOverly,
  canvasWidth = 100,
  canvasHeight = 100,
  topMargin = 20,
  leftMargin = 20
) {
  const canvasId = id;
  const inputText = "Random Text";
  const canvasWidthNew = canvasWidth;
  const canvasHeightNew = canvasHeight;
  const canvasTop = topMargin;
  const canvasLeft = leftMargin;

  // build canvas
  const canvas = document.createElement("canvas");
  canvas.width = canvasWidthNew;
  canvas.height = canvasHeightNew;
  canvas.id = canvasId;
  canvas.setAttribute("data-fabric-id", canvasId);

  // canvas container build
  const canvasCotainer = document.createElement("div");
  canvasCotainer.width = canvasWidthNew;
  canvasCotainer.height = canvasHeightNew;
  canvasCotainer.style.marginTop = canvasTop + "px";
  canvasCotainer.style.marginLeft = canvasLeft + "px";
  canvasCotainer.style.position = "absolute";
  canvasCotainer.style.cursor = "pointer";
  canvasCotainer.style.border = "1px gray dashed";
  //canvasCotainer.style.backgroundColor = "#0000ff";
  // canvasCotainer.setAttribute("onclick", "selectCanvas('" + canvasId + "')");
  canvasCotainer.appendChild(canvas);

  document.getElementById(canvasOverly).appendChild(canvasCotainer);

  const fabricElement = new fabric.Canvas(canvasId);
  allCanvasElements.push(fabricElement);

  // clipper
  function boundKeeper(e) {
    var obj = e.target;
    // if object is too big ignore
    if (
      obj.currentHeight > obj.canvas.height ||
      obj.currentWidth > obj.canvas.width
    ) {
      return;
    }
    obj.setCoords();
    // top-left  corner
    if (obj.getBoundingRect().top < 0 || obj.getBoundingRect().left < 0) {
      obj.top = Math.max(obj.top, obj.top - obj.getBoundingRect().top);
      obj.left = Math.max(obj.left, obj.left - obj.getBoundingRect().left);
    }
    // bot-right corner
    if (
      obj.getBoundingRect().top + obj.getBoundingRect().height >
        obj.canvas.height ||
      obj.getBoundingRect().left + obj.getBoundingRect().width >
        obj.canvas.width
    ) {
      obj.top = Math.min(
        obj.top,
        obj.canvas.height -
          obj.getBoundingRect().height +
          obj.top -
          obj.getBoundingRect().top
      );
      obj.left = Math.min(
        obj.left,
        obj.canvas.width -
          obj.getBoundingRect().width +
          obj.left -
          obj.getBoundingRect().left
      );
    }
  }

  fabricElement.on("object:moving", function (e) {
    boundKeeper(e);
  });

  // selection observer
  fabricElement.on("selection:created", function (event) {
    selectedItem = event.target;
  });

  fabricElement.on("selection:cleared", function () {
    selectedItem = null; // Clear the selected object when selection is cleared
  });

  fabricElement.on("object:scaling", function (e) {
    const maxScale = 1.5; // Set your desired maximum scale value

    const obj = e.target;
    if (obj.scaleX * obj.scaleY > maxScale) {
      obj.lockScalingX = true;
      obj.lockScalingY = true;
      setTimeout(() => {
        obj.lockScalingX = false;
        obj.lockScalingY = false;
      }, 100);
      obj.scaleX = maxScale;
      obj.scaleY = maxScale;
    } else {
      obj.lockScalingX = false;
      obj.lockScalingY = false;
    }
  });

  // click event
  fabricElement.on("mouse:down", function (event) {
    if (selectedInputCanvas) {
      const previousCanvasParent = selectedInputCanvas.getElement().parentNode;
      previousCanvasParent.style.border = "none";
    }

    //  set selected input canavs
    selectedInputCanvas = fabricElement;
    const parent = selectedInputCanvas.getElement().parentNode;
    parent.style.border = "2px black dashed";
  });

  fabricElement.on("mouse:dblclick", function () {
    selectedInputCanvas = fabricElement;
    openTextPanel();
  });

  fabricElement.on("mouse:over", function () {
    const fabricCanvas = document.getElementById(canvasId);
    fabricCanvas.parentElement.style.border = "1.5px dashed black";
  });

  fabricElement.on("mouse:out", function () {
    allCanvasElements.forEach((element) => {
      if (selectedInputCanvas != element) {
        element.getElement().parentNode.style.border = "none";
      } else {
        const fabricCanvas = document.getElementById(canvasId);
        fabricCanvas.style.border = "none";
      }
    });
  });
}

function textGenerator(fabricElement, inputText, options = {}) {
  // input values
  const fillColor = document.getElementById("textColorInput").value;
  const fontSize = document.getElementById("fontSizeInput").value;

  const defaultOptions = {
    left: 10,
    top: 10,
    fontFamily: "arial",
    fontSize: fontSize,
    fill: fillColor,
    fontWeight: "bold",
    fontStyle: "italic",
    textDecoration: "underline",
  };
  const margedOptions = Object.assign({}, defaultOptions, options);

  if (inputText !== "") {
    const text = new fabric.Textbox(inputText, margedOptions);
    fabricElement.add(text);
    // textChanger(text);
    fabricElement.renderAll();
  }
}

// function imageGenerator(fabricElement, file, options = {}) {
//   const DESIERED_WIDTH = 200;
//   const defaultOptions = {
//     left: 20,
//     top: 20,
//     scaleX: 0.3,
//     scaleY: 0.3,
//     angle: 0,
//     opacity: 1,
//   };

//   const mergedOptions1 = Object.assign({}, defaultOptions, options);

//   let url = file;
//   let imgPath = url; // Replace this with the correct path to your image
//   const imgObj = new Image();

//   let width = imgObj.width;
//   let height = imgObj.height;

//   let aspectRatio = width / height;
//   const DESIERED_HEIGHT = Math.round(DESIERED_WIDTH / aspectRatio);

//   var canvas = document.createElement("canvas");
//   canvas.width = DESIERED_WIDTH;
//   canvas.height = DESIERED_HEIGHT;

//   var ctx = canvas.getContext("2d");
//   ctx.drawImage(imgObj, 0, 0, DESIERED_WIDTH, DESIERED_HEIGHT);
//   imgPath = canvas.toDataURL("image/jpeg");

//   imgObj.onload = function () {
//     const image = new fabric.Image(imgObj, mergedOptions1);
//     fabricElement.add(image);
//     fabricElement.renderAll();
//   };

//   imgObj.src = imgPath;
//   document.body.appendChild(imgObj);
// }

function imageGenerator(fabricElement, file, options = {}) {
  imageSizeReducer(file, (URL) => {
    const dataURL = URL;
    console.log(dataURL);

    const imgObj = new Image();

    imgObj.onload = function () {
      const defaultOptions = {
        left: 20,
        top: 20,
        scaleX: 0.5,
        scaleY: 0.5,
        angle: 0,
        opacity: 1,
      };
      const mergedOptions = Object.assign({}, defaultOptions, options);

      const image = new fabric.Image(imgObj, mergedOptions);

      fabricElement.add(image);
      fabricElement.renderAll();
    };

    imgObj.src = dataURL;
  });
}

function imageSizeReducer(file, callback) {
  const imgObj = new Image();

  imgObj.onload = function () {
    const DESIRED_WIDTH = 200;
    let aspectRatio = imgObj.width / imgObj.height;
    const DESIRED_HEIGHT = Math.round(DESIRED_WIDTH / aspectRatio);

    var canvas = document.createElement("canvas");
    canvas.width = DESIRED_WIDTH;
    canvas.height = DESIRED_HEIGHT;

    var ctx = canvas.getContext("2d");
    ctx.drawImage(imgObj, 0, 0, DESIRED_WIDTH, DESIRED_HEIGHT);

    let URL = canvas.toDataURL("image/jpeg");
    callback(URL);
  };

  imgObj.src = file;
}

function generateDataUrlFromInputImage(file, callback) {
  var reader = new FileReader();

  reader.onload = function (event) {
    var dataUrl = event.target.result;
    callback(dataUrl);
  };

  reader.readAsDataURL(file);
}

// final renderer
let currentImageTextRenderViewImage = new Image();
function generateTextImageSections(sideId) {
  deselectAll();
  html2canvas(document.getElementById(sideId), {
    backgroundColor: "transparent",
  }).then((canvas) => {
    const img = new Image();
    img.src = canvas.toDataURL();
    currentImageTextRenderViewImage = img;
    let imageContainer = document.body;
    // imageContainer.innerHTML = "";
    imageContainer.appendChild(img);
  });
}

// Deselect all selected items
function deselectAll() {
  selectedInputCanvas = null;
  allCanvasElements.forEach((canvas) => {
    canvas.discardActiveObject();
    canvas.renderAll();
  });
}

// select a canvas
function selectCanvas(id = "test") {
  if (selectedInputCanvas) {
    deselectAll();
    selectedInputCanvas = id;
  }
}

// generate a unique id
function generateUniqueId() {
  const timestamp = new Date().getTime();
  const random = Math.floor(Math.random() * 10000); // Change the range as needed
  return `${timestamp}${random}`;
}

// remove items
function removeSelectedItem() {
  if (selectedItem && selectedItem.canvas == selectedInputCanvas) {
    selectedItem.canvas.remove(selectedItem);
  }
}

//
//
//
//
//
// test
document.addEventListener("DOMContentLoaded", () => {
  render(dataObject);
  productIdentifier();
});

// setInterval(() => {
//   generateTextImageSections();
// }, 5000);

function textChanger(fabricItem) {
  fabricItem.set({
    fontFamily: "Arial", // Font family
    fontSize: 12, // Font size in pixels
    fontWeight: "bold", // Font weight ('normal', 'bold', 'bolder', 'lighter', etc.)
    fontStyle: "italic", // Font style ('normal', 'italic', 'oblique')
  });
}

//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//

//  design data object
let dataObject = {
  sizeQuntitySets: [],
  gender: "male",
  clothType: "polo-t-shirt",
  printType: "ScreenPrint",
  mainColorHueValue: 100,
  mainColorSaturateValue: 0,
  mainColorLevelValue: 2.5,
  clothOption: {
    sleves: "shortSleeves",
    neck: "vneck",
    buttons: null,
  },
  views: {
    active: "front",
    strips: {
      neck: [],
      arm: [],
      sides: [],
    },
    imageTextContanerData: null,
    generatedTextData: [],
  },
};

// cloth image text object

// renderer
function render(dataObject) {
  const container = document.getElementById("canvas");
  container.innerHTML = ""; // clean renverer view

  // render view build
  const canvas = document.createElement("canvas");
  canvas.id = "designPanelCanvas";
  // canvas.style.backgroundColor = "blue"; // test canvas bg color

  //  render setup
  canvas.width = parseInt(
    window.getComputedStyle(document.getElementById("canvas")).width
  );
  canvas.height = parseInt(
    window.getComputedStyle(document.getElementById("canvas")).height
  );
  container.appendChild(canvas);

  // // recatch renderer
  // const newInstanceOfCanvas = document.getElementById("designPanelCanvas");
  // let x;
  // let y;
  // newInstanceOfCanvas.addEventListener("click", (event) => {
  //   x = event.clientX - newInstanceOfCanvas.getBoundingClientRect().x;
  //   y = event.clientY - newInstanceOfCanvas.getBoundingClientRect().y;
  // });

  clothRenderer(canvas, dataObject);
}

//
//
//
//
//

// image side must be bethween 400, 540
function clothRenderer(canvas, dataObject) {
  // draw image
  const image = document.createElement("img");
  let imageUrlStart = "images/cloths/" + dataObject.clothType + "-";
  let imageUrlEnd = dataObject.views.active + "_" + dataObject.gender + ".png";

  let imageUrl = "";

  if (dataObject.clothType == "polo-t-shirt") {
    imageUrl = imageUrlStart + imageUrlEnd;
  } else if (dataObject.clothType == "cotton-t-shirt") {
    if (dataObject.clothOption.sleves) {
      if (dataObject.clothOption.neck) {
        imageUrl =
          imageUrlStart +
          dataObject.clothOption.sleves +
          "-" +
          dataObject.clothOption.neck +
          "-" +
          imageUrlEnd;
      } else {
        imageUrl =
          imageUrlStart + dataObject.clothOption.sleves + "-" + imageUrlEnd;
      }
    } else {
      imageUrl =
        imageUrlStart + dataObject.clothOption.sleves + "-" + imageUrlEnd;
    }
  } else {
    imageUrl = imageUrlStart + imageUrlEnd;
  }

  image.setAttribute("src", imageUrl);

  let imageWidth = window.getComputedStyle(canvas).width;
  let imageHeight = window.getComputedStyle(canvas).height;

  const ctx = canvas.getContext("2d");
  image.onload = function () {
    ctx.filter =
      "hue-rotate(" +
      dataObject.mainColorHueValue +
      "deg) saturate(" +
      dataObject.mainColorSaturateValue +
      ") brightness(" +
      dataObject.mainColorLevelValue +
      ") "; // Apply the hue-rotate filter to the canvas context
    ctx.drawImage(image, 0, 0, parseInt(imageWidth), parseInt(imageHeight));
    ctx.filter = "none";
    ctx.drawImage(
      currentImageTextRenderViewImage,
      0,
      0,
      parseInt(imageWidth),
      parseInt(imageHeight)
    );

    // check cloth type
    if (dataObject.clothType == "polo-t-shirt") {
      poloTShirt(ctx, dataObject);
    } else if (dataObject.clothType == "bottom") {
      bottom(ctx, dataObject);
    } else if (dataObject.clothType == "short") {
      short(ctx, dataObject);
    } else if (dataObject.clothType == "jacket") {
      jacket(ctx, dataObject);
    }
    // testLineCreator(ctx, dataObject); // tester
  };
}

//  functions
// image section functions
// poloTShirt
function poloTShirt(ctx, dataObject) {
  const stripObject = dataObject.views.strips;
  stripDrawerpoloTShirt(ctx, stripObject, dataObject.views.active);
}

function stripDrawerpoloTShirt(ctx, stripObjects, side) {
  const neckStripsArray = stripObjects.neck;
  const armStripsArray = stripObjects.arm;
  const sidesStripsArray = stripObjects.sides;

  if (side == "front") {
    // neck strips
    for (let x = 0; x < neckStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          127,
          46,
          179,
          86,
          neckStripsArray[0].thickness,
          neckStripsArray[0].color
        );
        drawLine(
          ctx,
          272,
          46,
          219,
          83,
          neckStripsArray[0].thickness,
          neckStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          130,
          40,
          182,
          81,
          neckStripsArray[1].thickness,
          neckStripsArray[1].color
        );
        drawLine(
          ctx,
          268,
          40,
          215,
          78,
          neckStripsArray[1].thickness,
          neckStripsArray[1].color
        );
      } else if (x == 2) {
        drawLine(
          ctx,
          133,
          34,
          186,
          75,
          neckStripsArray[2].thickness,
          neckStripsArray[2].color
        );
        drawLine(
          ctx,
          265,
          34,
          210,
          72,
          neckStripsArray[2].thickness,
          neckStripsArray[2].color
        );
      }
    }

    // arm strips
    for (let x = 0; x < armStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          0,
          241,
          69,
          260,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
        drawLine(
          ctx,
          400,
          244,
          329,
          258,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          0,
          236,
          70,
          256,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
        drawLine(
          ctx,
          400,
          239,
          328,
          254,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
      } else if (x == 2) {
        drawLine(
          ctx,
          0,
          231,
          71,
          251,
          armStripsArray[2].thickness,
          armStripsArray[2].color
        );
        drawLine(
          ctx,
          399,
          235,
          327,
          250,
          armStripsArray[2].thickness,
          armStripsArray[2].color
        );
      }
    }
  } else if (side == "back") {
    for (let x = 0; x < neckStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          140,
          33,
          260,
          35,
          neckStripsArray[0].thickness,
          neckStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          143,
          28,
          257,
          30,
          neckStripsArray[1].thickness,
          neckStripsArray[1].color
        );
      } else if (x == 2) {
        drawLine(
          ctx,
          146,
          23,
          254,
          25,
          neckStripsArray[2].thickness,
          neckStripsArray[2].color
        );
      }
    }

    for (let x = 0; x < armStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          3,
          241,
          69,
          260,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
        drawLine(
          ctx,
          395,
          244,
          325,
          258,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          3,
          236,
          70,
          256,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
        drawLine(
          ctx,
          395,
          239,
          324,
          254,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
      } else if (x == 2) {
        drawLine(
          ctx,
          3,
          231,
          71,
          251,
          armStripsArray[2].thickness,
          armStripsArray[2].color
        );
        drawLine(
          ctx,
          394,
          235,
          323,
          250,
          armStripsArray[2].thickness,
          armStripsArray[2].color
        );
      }
    }
  } else if (side == "left") {
    // neck
    for (let x = 0; x < neckStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          156,
          80,
          240,
          28,
          neckStripsArray[0].thickness,
          neckStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          153,
          76,
          238,
          23,
          neckStripsArray[1].thickness,
          neckStripsArray[1].color
        );
      } else if (x == 2) {
        drawLine(
          ctx,
          149,
          70,
          235,
          18,
          neckStripsArray[2].thickness,
          neckStripsArray[2].color
        );
      }
    }

    // arm
    for (let x = 0; x < armStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          169,
          244,
          256,
          244,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          169,
          240,
          256,
          240,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
      } else if (x == 2) {
        drawLine(
          ctx,
          169,
          236,
          256,
          236,
          armStripsArray[2].thickness,
          armStripsArray[2].color
        );
      }
    }

    // sides - kaviska - change line position
    for (let x = 0; x < sidesStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          216,
          248,
          205,
          535,
          sidesStripsArray[0].thickness,
          sidesStripsArray[0].color
        );
      }
      if (x == 1) {
        drawLine(
          ctx,
          216,
          268,
          205,
          565,
          sidesStripsArray[0].thickness,
          sidesStripsArray[1].color
        );
      }
      if (x == 2) {
        drawLine(
          ctx,
          216,
          298,
          205,
          595,
          sidesStripsArray[0].thickness,
          sidesStripsArray[2].color
        );
      }
    }
  } else if (side == "right") {
    for (let x = 0; x < neckStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          154,
          32,
          235,
          82,
          neckStripsArray[0].thickness,
          neckStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          156,
          28,
          238,
          78,
          neckStripsArray[1].thickness,
          neckStripsArray[1].color
        );
      } else if (x == 2) {
        drawLine(
          ctx,
          159,
          23,
          241,
          73,
          neckStripsArray[2].thickness,
          neckStripsArray[2].color
        );
      }
    }

    for (let x = 0; x < armStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          134,
          244,
          223,
          244,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          134,
          240,
          223,
          240,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
      } else if (x == 2) {
        drawLine(
          ctx,
          134,
          236,
          223,
          236,
          armStripsArray[2].thickness,
          armStripsArray[2].color
        );
      }
    }

    // sides - kaviska - fix line position
    for (let x = 0; x < sidesStripsArray.length; x++) {
      consolelog(sidesStripsArray);
      if (x == 0) {
        drawLine(
          ctx,
          175,
          248,
          185,
          535,
          sidesStripsArray[0].thickness,
          sidesStripsArray[0].color
        );
      }

      if (x == 1) {
        drawLine(
          ctx,
          175,
          248,
          185,
          535,
          sidesStripsArray[0].thickness,
          sidesStripsArray[1].color
        );
      }

      if (x == 2) {
        drawLine(
          ctx,
          175,
          248,
          185,
          535,
          sidesStripsArray[0].thickness,
          sidesStripsArray[2].color
        );
      }
    }
  }
}

// Bottom
function bottom(ctx, dataObject) {
  const stripObject = dataObject.views.strips;
  stripDrawerBottom(ctx, stripObject, dataObject.views.active);
}

function stripDrawerBottom(ctx, stripObjects, side) {
  // alert("success");

  const neckStripsArray = stripObjects.neck;
  const armStripsArray = stripObjects.arm;
  const sidesStripsArray = stripObjects.sides;

  if (side == "front") {
  } else if (side == "back") {
  } else if (side == "left") {
    for (let x = 0; x <= sidesStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          197,
          30,
          213,
          520,
          // sidesStripsArray[0].thickness,
          sidesStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          187,
          30,
          203,
          520,
          // sidesStripsArray[1].thickness,
          sidesStripsArray[1].color
        );
      }
    }
  } else if (side == "right") {
    for (let x = 0; x < neckStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          200,
          30,
          185,
          520,
          // sidesStripsArray[0].thickness,
          sidesStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          190,
          30,
          175,
          520,
          // sidesStripsArray[1].thickness,
          sidesStripsArray[1].color
        );
      }
    }
  }
}

//shorts
function short(ctx, dataObject) {
  const stripObject = dataObject.views.strips;
  stripDrawerShort(ctx, stripObject, dataObject.views.active);
}

function stripDrawerShort(ctx, stripObjects, side) {
  // alert("success");

  const neckStripsArray = stripObjects.neck;
  const armStripsArray = stripObjects.arm;
  const sidesStripsArray = stripObjects.sides;

  if (side == "front") {
  } else if (side == "back") {
  } else if (side == "left") {
    for (let x = 0; x <= sidesStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          210,
          88,
          200,
          490,
          // sidesStripsArray[0].thickness,
          sidesStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          220,
          88,
          210,
          490,
          // sidesStripsArray[1].thickness,
          sidesStripsArray[1].color
        );
      }
    }
  } else if (side == "right") {
    for (let x = 0; x < neckStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          185,
          88,
          200,
          490,
          // sidesStripsArray[0].thickness,
          sidesStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          175,
          88,
          190,
          490,
          // sidesStripsArray[1].thickness,
          sidesStripsArray[1].color
        );
      }
    }
  }
}

//jacket
function jacket(ctx, dataObject) {
  const stripObject = dataObject.views.strips;
  stripDrawerJacket(ctx, stripObject, dataObject.views.active);
}

function stripDrawerJacket(ctx, stripObjects, side) {
  // alert("success");

  const neckStripsArray = stripObjects.neck;
  const armStripsArray = stripObjects.arm;
  const sidesStripsArray = stripObjects.sides;

  if (side == "front") {
  } else if (side == "back") {
  } else if (side == "left") {
    for (let x = 0; x <= armStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          210,
          92,
          210,
          300,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
        drawLine(
          ctx,
          210,
          300,
          130,
          480,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          220,
          92,
          220,
          300,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
        drawLine(
          ctx,
          220,
          300,
          140,
          485,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
      }
    }
  } else if (side == "right") {
    for (let x = 0; x < armStripsArray.length; x++) {
      if (x == 0) {
        drawLine(
          ctx,
          190,
          92,
          190,
          300,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
        drawLine(
          ctx,
          190,
          300,
          270,
          480,
          armStripsArray[0].thickness,
          armStripsArray[0].color
        );
      } else if (x == 1) {
        drawLine(
          ctx,
          180,
          92,
          180,
          300,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
        drawLine(
          ctx,
          180,
          300,
          260,
          485,
          armStripsArray[1].thickness,
          armStripsArray[1].color
        );
      }
    }
  }
}

// draw lines
function drawLine(ctx, startX, startY, endX, endY, thickness = 1, color) {
  // Set line attributes
  ctx.beginPath();
  ctx.moveTo(startX, startY);
  ctx.lineTo(endX, endY);
  ctx.strokeStyle = color;
  ctx.lineWidth = thickness;
  ctx.stroke();
}

function colorUpdate(hue, saturation, value) {
  dataObject.mainColorHueValue = hue;
  dataObject.mainColorSaturateValue = saturation;
  dataObject.mainColorLevelValue = value;
  render(dataObject);
}

//
//
//
//
//
//
//
//
//
//

// testers
function testLineCreator(ctx, dataObject) {
  const testData = dataObject.test;
  drawLine(
    ctx,
    testData.startX,
    testData.startY,
    testData.endX,
    testData.endY,
    testData.thickness,
    testData.color
  );
}

function printImage(canvas) {
  // Get the data URL of the canvas
  const dataURL = canvas.toDataURL("image/png");

  // Create an image element
  const image = new Image();

  // Set the source of the image to the data URL
  image.src = dataURL;

  // Append the image to the document
  document.body.appendChild(image);
}

// document.getElementById("colorInput").addEventListener("change", () => {
//   dataObject.mainColorHueValue = document.getElementById("colorInput").value;
//   render(dataObject);
// });

function changeProduct(dress) {
  dataObject.clothType = dress;
  render(dataObject);
}
// Create an array to store the data sets
const dataSets = [];

// Function to save the data
// Function to save the data in sizeQuntity object
function size() {
  // Get the values
  var xs = parseInt(document.getElementById("xs").value);
  var s = parseInt(document.getElementById("s").value);
  var m = parseInt(document.getElementById("m").value);
  var l = parseInt(document.getElementById("l").value);
  var xl = parseInt(document.getElementById("xl").value);
  var doublexl = parseInt(document.getElementById("2xl").value);
  var thribblexl = parseInt(document.getElementById("3xl").value);
  // Get the selected gender and budget
  const selectedGender = getSelectedGender();
  const selectedBudget = getSelectedBudget();

  // Create a new data object to store the current data
  const newData = {
    timestamp: Date.now(), // Add a timestamp to identify this data set
    gender: selectedGender,
    matirial: selectedBudget,
    xs: xs,
    s: s,
    m: m,
    l: l,
    xl: xl,
    doublexxl: doublexl,
    thribblexxl: thribblexl,
  };

  // Push the new data object into the sizeQuntitySets array
  dataObject.sizeQuntitySets.push(newData);

  xs = isNaN(xs) ? 0 : xs;
  s = isNaN(s) ? 0 : s;
  m = isNaN(m) ? 0 : m;
  l = isNaN(l) ? 0 : l;
  xl = isNaN(xl) ? 0 : xl;
  doublexl = isNaN(doublexl) ? 0 : doublexl;
  thribblexl = isNaN(thribblexl) ? 0 : thribblexl;

  // Calculate and display the total
  var total = xs + s + m + l + xl + doublexl + thribblexl;
  const sizeItemsDiv = document.getElementById("sizeItems");
  sizeItemsDiv.textContent = total;

  if (
    newData.gender == "combinationMen" &&
    newData.matirial == "combinationBudget"
  ) {
    const sizeItemsDiv = document.getElementById("mb");
    sizeItemsDiv.textContent = total;
  }
  if (
    newData.gender == "combinationMen" &&
    newData.matirial == "combinationCoperate"
  ) {
    const sizeItemsDiv = document.getElementById("mc");
    sizeItemsDiv.textContent = total;
  }
  if (
    newData.gender == "combinationWomen" &&
    newData.matirial == "combinationBudget"
  ) {
    const sizeItemsDiv = document.getElementById("wb");
    sizeItemsDiv.textContent = total;
  }
  if (
    newData.gender == "combinationWomen" &&
    newData.matirial == "combinationCoperate"
  ) {
    const sizeItemsDiv = document.getElementById("wc");
    sizeItemsDiv.textContent = total;
  }

  // Optional: Log the updated dataObject to the console
  console.log(dataObject);
  // Clear the input fields
  document.getElementById("xs").value = "";
  document.getElementById("s").value = "";
  document.getElementById("m").value = "";
  document.getElementById("l").value = "";
  document.getElementById("xl").value = "";
  document.getElementById("2xl").value = "";
  document.getElementById("3xl").value = "";

  window.alert("data added sucessfully");

  const spans = document.querySelectorAll(".right-side-box-num");

  let totals = 0;

  // Loop through each span and accumulate the total
  spans.forEach((span) => {
    const content = span.textContent.trim(); // Get the text content and remove any leading/trailing spaces
    const value = parseFloat(content) || 0; // Convert the content to a number, default to 0 if conversion fails
    totals += value;
  });

  console.log(totals);

  // Set the display property of the button based on the total value
}

// Function to get the value of the selected radio button for gender
function getSelectedGender() {
  let selectedGender = "";
  const genderRadios = document.querySelectorAll(
    'input[name="combinationGender"]'
  );
  genderRadios.forEach((radio) => {
    if (radio.checked) {
      selectedGender = radio.id;
    }
  });
  return selectedGender;
}

// Function to get the value of the selected radio button for budget
function getSelectedBudget() {
  let selectedBudget = "";
  const budgetRadios = document.querySelectorAll(
    'input[name="combinationBudget"]'
  );
  budgetRadios.forEach((radio) => {
    if (radio.checked) {
      selectedBudget = radio.id;
    }
  });
  return selectedBudget;
}

// Get the element with the ID 'sizeItems'

//
//
//
// test line creator
//
// document.getElementById("startingPointXTest").addEventListener("change", () => {
//   dataObject.test.startX = document.getElementById("startingPointXTest").value;
//   render(dataObject);
// });
// document.getElementById("startingPointYTest").addEventListener("change", () => {
//   dataObject.test.startY = document.getElementById("startingPointYTest").value;
//   render(dataObject);
// });
// document.getElementById("endingPointXTest").addEventListener("change", () => {
//   dataObject.test.endX = document.getElementById("endingPointXTest").value;
//   render(dataObject);
// });
// document.getElementById("endingPointYTest").addEventListener("change", () => {
//   dataObject.test.endY = document.getElementById("endingPointYTest").value;
//   render(dataObject);
// });
// document.getElementById("thicknessTest").addEventListener("change", () => {
//   dataObject.test.thickness = document.getElementById("thicknessTest").value;
//   render(dataObject);
// });
// document.getElementById("colorTest").addEventListener("change", () => {
//   dataObject.test.color = document.getElementById("colorTest").value;
//   render(dataObject);
// });

//
//
//
//
//
//
//
// image renderer
//
//
//
//
//

function savindDataForOrder() {
  const savedTextDataArray = [];
  for (let u = 0; u < allCanvasElements.length; u++) {
    let textData = {
      id: allCanvasElements[u].lowerCanvasEl.id,
      data: JSON.stringify(allCanvasElements[u].toJSON()),
    };

    savedTextDataArray.push(textData);
  }

  dataObject.views.generatedTextData = savedTextDataArray;
}

function saveCurrentDesign() {
  savindDataForOrder();

  renderStartEffects();

  let dataURLFront;
  let dataURLBack;
  let dataURLLeft;
  let dataURLRight;
  // front
  dataObject.views.active = "front";
  viewChange("front");
  generateTextImageSections("canvasOverlyFront");
  setTimeout(() => {
    render(dataObject);
  }, 1000);

  setTimeout(() => {
    dataURLFront = generateFront();
    dataObject.views.active = "back";
    viewChange("back");
    generateTextImageSections("canvasOverlyBack");
    setTimeout(() => {
      render(dataObject);
    }, 1000);
  }, 4000);

  setTimeout(() => {
    dataURLBack = generateBack();
    dataObject.views.active = "left";
    viewChange("left");
    generateTextImageSections("canvasOverlyLeft");
    setTimeout(() => {
      render(dataObject);
    }, 1000);
  }, 8000);

  setTimeout(() => {
    dataURLLeft = generateLeft();
    dataObject.views.active = "right";
    viewChange("right");
    generateTextImageSections("canvasOverlyRight");
    setTimeout(() => {
      render(dataObject);
    }, 1000);
  }, 12000);

  setTimeout(() => {
    dataURLRight = generateRight();

    let imageObject = {
      dataURLFront: dataURLFront,
      dataURLBack: dataURLBack,
      dataURLLeft: dataURLLeft,
      dataURLRight: dataURLRight,
    };

    dataObject.views.active = "front"; // set default view
    viewChange("front");

    let form = new FormData();
    form.append("imageObject", JSON.stringify(imageObject));
    form.append("design_json", JSON.stringify(dataObject));

    let request = new XMLHttpRequest();
    request.onreadystatechange = function () {
      if (request.readyState == 4) {
        console.log(request.responseText);
        try {
          let response = JSON.parse(request.responseText);
          if (response.status == "success") {
            alert("Successfully saved");
            window.location.reload();
          } else if (response.status == "failed") {
            alert(response.error);
          }
        } catch (error) {
          console.log(error);
        }
        render(dataObject);
      }
    };

    request.open("POST", SERVER_URL + "backend/save_design_api.php", true);
    request.send(form);
    renderEndEffects();
  }, 14000);
}

function generateFront() {
  return document.getElementById("designPanelCanvas").toDataURL();
}
function generateBack() {
  return document.getElementById("designPanelCanvas").toDataURL();
}
function generateRight() {
  return document.getElementById("designPanelCanvas").toDataURL();
}
function generateLeft() {
  return document.getElementById("designPanelCanvas").toDataURL();
}

function renderStartEffects() {
  document.querySelectorAll(".section1-panel-sides").forEach((element) => {
    element.classList.add("d-none");
    element.classList.remove("d-flex");
  });

  const toastBootstrap = bootstrap.Toast.getOrCreateInstance(
    document.getElementById("renderStartToastMessage")
  );

  toastBootstrap.show();
}

function renderEndEffects() {
  document.querySelectorAll(".section1-panel-sides").forEach((element) => {
    element.classList.add("d-flex");
    element.classList.remove("d-none");
  });
}
